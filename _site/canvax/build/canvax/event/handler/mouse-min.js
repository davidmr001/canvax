define("canvax/event/handler/mouse",["canvax/core/Base","canvax/display/Point","canvax/event/CanvaxEvent"],function(a,b,c){var d=function(){};return d.prototype={init:function(){var b=0,c=this,d=this.canvax;_.each(["click","dblclick","mousedown","mousemove","mouseup","mouseout"],function(e){a.addEvent(d.el,e,function(a){if(d.updateRootOffset(),"mousemove"==a.type){if(1>b)return void b++;b=0}c.__mouseHandler(a)})})},__mouseHandler:function(a){var d=this,e=d.canvax;d.curPoints=[new b(c.pageX(a)-e.rootOffset.left,c.pageY(a)-e.rootOffset.top)];var f=d.curPoints[0],g=d.curPointsTarget[0];if("mousedown"==a.type){if(!g){var h=e.getObjectsUnderPoint(f,1)[0];h&&(d.curPointsTarget=[h])}g=d.curPointsTarget[0],g&&g.dragEnabled&&(d._touching=!0)}var i=document.compareDocumentPosition?function(a,b){return b?!!(16&a.compareDocumentPosition(b)):!1}:function(a,b){return b?b!==b&&(a.contains?a.contains(b):!0):!1};if(("mouseup"==a.type||"mouseout"==a.type&&!i(e.el,a.toElement||a.relatedTarget))&&(1==d._draging&&d._dragEnd(a,g,0),d._draging=!1,d._touching=!1),"mouseout"==a.type)i(e.el,a.toElement||a.relatedTarget)||d.__getcurPointsTarget(a,f);else if("mousemove"==a.type)d._touching&&"mousemove"==a.type&&g?(d._draging?d._dragHander(a,g,0):(g.dragBegin&&g.dragBegin(a),g.context.visible=!1,d._clone2hoverStage(g,0)),d._draging=!0):d.__getcurPointsTarget(a,f);else{var j=g;j||(j=e),d.__dispatchEventInChilds(a,[j])}e.preventDefault&&(a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1)},__getcurPointsTarget:function(b,d){var e=this,f=e.canvax,g=e.curPointsTarget[0],b=a.copyEvent(new c,b);if("mousemove"==b.type&&g&&g._hoverClass&&g.pointChkPriority&&g.getChildInPoint(d))return b.target=b.currentTarget=g,b.point=g.globalToLocal(d),void g.dispatchEvent(b);var h=f.getObjectsUnderPoint(d,1)[0];if(g&&g!=h||"mouseout"==b.type){if(!g)return;e.curPointsTarget[0]=null,b.type="mouseout",b.toTarget=h,b.target=b.currentTarget=g,b.point=g.globalToLocal(d),g.context.visible||(g.context.visible=!0),g.dispatchEvent(b)}h&&g!=h&&(e.curPointsTarget[0]=h,b.type="mouseover",b.fromTarget=g,b.target=b.currentTarget=h,b.point=h.globalToLocal(d),h.dispatchEvent(b)),"mousemove"==b.type&&h&&(b.target=b.currentTarget=g,b.point=g.globalToLocal(d),g.dispatchEvent(b)),e._cursorHander(h,g)},_cursorHander:function(a,b){a||b||this._setCursor("default"),a&&b!=a&&this._setCursor(a.context.cursor)},_setCursor:function(a){this._cursor!=a&&(this.canvax.el.style.cursor=a,this._cursor=a)}},d});